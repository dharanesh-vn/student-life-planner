<div class="container">
  <div *ngIf="isLoading" class="loading-overlay"><div class="spinner"></div></div>
  <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <h2>Course Management</h2>

  <div class="card">
    <h3>{{ isEditMode ? 'Edit Course' : 'Add a New Course' }}</h3>
    <form (ngSubmit)="onSubmitCourse()">
      <div class="form-group">
        <label for="courseName">Course Name *</label>
        <input id="courseName" [(ngModel)]="courseData.courseName" name="courseName" type="text" required>
      </div>
      <div class="form-group" style="margin-top: 1.25rem;">
        <label for="instructor">Instructor</label>
        <input id="instructor" [(ngModel)]="courseData.instructor" name="instructor" type="text">
      </div>

      <div class="schedule-section">
        <label>Schedule</label>
        <div class="day-selector">
          <label *ngFor="let day of days" class="day-chip" [class.selected]="daySelection[day]">
            <input type="checkbox" [(ngModel)]="daySelection[day]" [name]="day">
            {{ day.substring(0, 3) }}
          </label>
        </div>
        <div class="time-inputs">
          <div class="form-group">
            <label for="startTime">Start Time</label>
            <input id="startTime" type="time" [(ngModel)]="courseData.scheduleStartTime" name="startTime">
          </div>
          <div class="form-group">
            <label for="endTime">End Time</label>
            <input id="endTime" type="time" [(ngModel)]="courseData.scheduleEndTime" name="endTime">
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="primary">{{ isEditMode ? 'Update Course' : 'Add Course' }}</button>
        <button type="button" *ngIf="isEditMode" (click)="resetForm()" class="secondary">Cancel Edit</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h3>My Courses</h3>
    <div *ngIf="courses.length === 0 && !isLoading; else courseList" class="empty-state">
      You haven't added any courses yet. Use the form above to get started!
    </div>
    <ng-template #courseList>
      <div class="course-grid">
        <div class="course-card" *ngFor="let course of courses; let i = index" [ngClass]="'color-' + (i % 6)">
          <div class="course-card-header">
            <h4>{{ course.courseName }}</h4>
            <div class="course-actions">
              <button (click)="onEdit(course)" title="Edit Course">&#9998;</button>
              <button (click)="onDelete(course._id)" title="Delete Course">&#10006;</button>
            </div>
          </div>
          <div class="course-card-body">
            <p *ngIf="course.instructor"><strong>Instructor:</strong> {{ course.instructor }}</p>
            <p *ngIf="course.scheduleDays && course.scheduleDays.length > 0">
              <strong>Schedule:</strong> 
              {{ course.scheduleDays.join(', ') }} 
              <span *ngIf="course.scheduleStartTime && course.scheduleEndTime">
                from {{ course.scheduleStartTime }} to {{ course.scheduleEndTime }}
              </span>
            </p>
          </div>
          <div class="course-card-footer">
            <a [routerLink]="['/academic/courses', course._id, 'notes']" class="notes-link">View Notes</a>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</div>